var fl;!function(e){function t(t){var n=!0;return t&&e.P_$UIComponent in t&&(n=t[e.P_$UIComponent][29]),n}function n(t,n){a(t)&&(t=egret.getDefinitionByName(t)),t&&(t[e.P_$fl$contextView]=n)}function i(t){a(t)&&(t=egret.getDefinitionByName(t)),t&&(t[e.P_$fl$contextView]=null)}function r(t){var n;if(p(t)){if(n=t[e.P_$fl$contextView])return n;t=t.constructor}return u(t)&&(n=t[e.P_$fl$contextView]),n}function s(t){var n=t.prototype;Object.defineProperty(n,"initialized",{configurable:!0,enumerable:!0,get:function(){return e.isComponentInited(this)}});var i,s,o=n.$onAddToStage;n.$onAddToStage=function(e,t){o.apply(this,arguments),i=r(this),i&&(s=egret.Event.create(egret.Event,egret.Event.ADDED_TO_STAGE),s.$setTarget(this),s.$currentTarget=i,i.$notifyListener(s,!0))};var a=n.$onRemoveFromStage;n.$onRemoveFromStage=function(){a.apply(this,arguments),i=r(this),i&&(s=egret.Event.create(egret.Event,egret.Event.REMOVED_FROM_STAGE),s.$setTarget(this),s.$currentTarget=i,i.$notifyListener(s,!0))}}function o(e){var t=typeof e;return"object"===t?(t=Object.prototype.toString.call(e),"[object Number]"===t):"number"===t}function a(e){var t=typeof e;return"object"===t?(t=Object.prototype.toString.call(e),"[object String]"===t):"string"===t}function c(e){return Array.isArray?Array.isArray(e):e?"[object Array]"===Object.prototype.toString.call(e):void 0}function p(e){var t=typeof e;return"object"===t}function u(e){var t=typeof e;return"function"===t}function l(e,t){if(e===t)return!0;if(!e||!t)return!1;var n;if(a(e))n=[e];else{var i=e.prototype?e.prototype:Object.getPrototypeOf(e);if(n=i?i.__types__:null,!n)return!1}return t=f(t),-1!==n.indexOf(t)}function f(t,n){void 0===n&&(n=!1);var i;return i=e.isString(t)?t:egret.getQualifiedClassName(t),n?i.replace("::","."):i}function h(e){switch(e){case" ":case"	":case"\r":case"\n":case"\f":return!0;default:return!1}}function v(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(null==t)return"";var r,s=n.length;1==s&&e.isArray(n[0])?(r=n[0],s=r.length):r=n;for(var o=0;s>o;o++)t=t.replace(new RegExp("\\{"+o+"\\}","g"),r[o]);return t}function d(t){return e.LINE_BREAKS.lastIndex=0,t?t.replace(e.LINE_BREAKS,""):t}function m(e,t,n){void 0===t&&(t=2),void 0===n&&(n=!0);var i=e.toFixed(t);if(n&&t>0){for(var r=i.length-1;r>=0;r--){var s=i.charAt(r);if("."==s)break;if("0"!=s){r++;break}}i=i.substring(0,r)}return i}function g(e,t,n){return e.split(t).join(n)}function C(e,t){var n=!1;if(e==t)n=!0;else if(null==e||null==t)n=!1;else{var i=new RegExp("^"+t+"$","m");n=null!=e.match(i)}return n}function _(t,n,i,r,s,o,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a="SimSun");var c="";null!=n&&(c=e.getColorStr(e.getColor(n)),c="color='"+c+"'");var p="";null!=i&&(p="size='"+i+"'");var u="";null!=a&&(u="face='"+a+"'");var l=e.substitute(e.COLOR_TEXT,c,p,u,t);return r&&(l="<b>"+l+"</b>"),s&&(l="<u>"+l+"</u>"),o&&(l="<i>"+l+"</i>"),l}function I(e){for(var t=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);t+=i>=0&&126>=i?1:2}return t}function w(e){var t=0;if(!e)return 0;for(var n=e.length,i=0;n>i;i++)t+=e.charCodeAt(i)>=127?2:1;return t}function E(e,t){for(var n="",i=0;t>i;i++)n+=e;return n}function M(t,n,i,r){void 0===r&&(r=!0);var s=e.strByteLen(r?t.replace(e.HTML_TAG,""):t);return t+e.repeatStr(i,n-s)}function y(e,t){var n=Math.max(Math.min((e>>16&255)+t,255),0),i=Math.max(Math.min((e>>8&255)+t,255),0),r=Math.max(Math.min((255&e)+t,255),0);return n<<16|i<<8|r}function j(e,t){var n=0,i=0,r=0;return 0==t?e:(0>t?(t=(100+t)/100,n=(e>>16&255)*t,i=(e>>8&255)*t,r=(255&e)*t):(t/=100,n=e>>16&255,i=e>>8&255,r=255&e,n+=(255-n)*t,i+=(255-i)*t,r+=(255-r)*t,n=Math.min(n,255),i=Math.min(i,255),r=Math.min(r,255)),n<<16|i<<8|r)}function x(e,t){var n=e>>16&255,i=e>>8&255,r=255&e,s=t>>16&255,o=t>>8&255,a=255&t;return n*s/255<<16|i*o/255<<8|r*a/255}function V(e){var t="#";return t+=e.toString(16)}function R(e){return Number("0x"+e.substr(1,e.length))}function T(t){var n=0;return n=e.isString(t)&&"#"==String(t).charAt(0)?e.getColorInt(t):Number(t)}e.P_$UIComponent="$UIComponent",e.isComponentInited=t,e.P_$fl$contextView="$fl$contextView",e.injectContextView=n,e.uninjectContextView=i,e.getContextView=r,e.hookContextView=s,e.isNumber=o,e.isString=a,e.isArray=c,e.isObject=p,e.isClass=u,e.is=l,e.getClassName=f,e.isWhitespace=h,e.substitute=v,e.joinLines=d,e.toFixed=m,e.replaceText=g,e.stringFullMatch=C,e.formatHtml=_,e.getWordWidth=I,e.strByteLen=w,e.repeatStr=E,e.complementByChar=M,e.adjustBrightness=y,e.adjustBrightness2=j,e.rgbMultiply=x,e.getColorStr=V,e.getColorInt=R,e.getColor=T}(fl||(fl={})),fl.LINE_BREAKS=new RegExp("[\r\n]+","img"),fl.COLOR_TEXT="<font {0} {1} {2}>{3}</font>",fl.HTML_TAG=/<[^>]+>/g,fl.hookContextView(egret.DisplayObject);var fl;!function(e){var t=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=0),this.name=t,this.message=e}var t=(__define,e);return p=t.prototype,e}();e.Error=t,egret.registerClass(t,"fl.Error")}(fl||(fl={}));var fl;!function(e){var t=function(){function e(e){this.map=new Array}var t=(__define,e);return p=t.prototype,p.getItem=function(e,t){for(var n=0;n<this.map.length;n++)if(this.map[n][0]==e)return this.map[n][1];return t&&this.map.push([e,t]),t},p.setItem=function(e,t){for(var n=0;n<this.map.length;n++)if(this.map[n][0]==e)return void(this.map[n][1]=t);return this.map.push([e,t]),t},p.delItem=function(e){for(var t,n=0;n<this.map.length;n++)if(this.map[n][0]==e){t=this.map[n][1],this.map.splice(n,1);break}return t},p.hasOwnProperty=function(e){if(void 0==this.map||void 0==this.map.length)return!1;for(var t=0;t<this.map.length;t++)if(this.map[t][0]==e)return!0;return!1},e}();e.Dictionary=t,egret.registerClass(t,"fl.Dictionary")}(fl||(fl={}));var fl;!function(e){e.ICommandMap="fl.ICommandMap"}(fl||(fl={}));var fl;!function(e){e.IContext="fl.IContext"}(fl||(fl={}));var fl;!function(e){e.IContextProvider="fl.IContextProvider"}(fl||(fl={}));var fl;!function(e){e.IEventMap="fl.IEventMap"}(fl||(fl={}));var fl;!function(e){e.IInjector="fl.IInjector"}(fl||(fl={}));var fl;!function(e){e.IMediator="fl.IMediator"}(fl||(fl={}));var fl;!function(e){e.IMediatorMap="fl.IMediatorMap"}(fl||(fl={}));var fl;!function(e){e.IReflector="fl.IReflector"}(fl||(fl={}));var fl;!function(e){e.IViewMap="fl.IViewMap"}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(e,n){t.call(this),this.request=e,this.injectionName=n}__extends(n,t);var i=(__define,n);return p=i.prototype,p.getResponse=function(e){var t=this.m_injector||e;if(this.m_result)return this.m_result.getResponse(t);var n=t.getAncestorMapping(this.request,this.injectionName);return n?n.getResponse(e):null},p.hasResponse=function(e){if(this.m_result)return!0;var t=this.m_injector||e,n=t.getAncestorMapping(this.request,this.injectionName);return null!=n},p.hasOwnResponse=function(){return null!=this.m_result},p.setResult=function(t){null!=this.m_result&&null!=t&&console.log('Warning: Injector already has a rule for type "'+e.getClassName(this.request)+'", named "'+this.injectionName+'".\n If you have overwritten this mapping intentionally you can use "injector.unmap()" prior to your replacement mapping in order to avoid seeing this message.'),this.m_result=t},p.setInjector=function(e){this.m_injector=e},n}(egret.HashObject);e.InjectionConfig=t,egret.registerClass(t,"fl.InjectionConfig")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t);return p=n.prototype,t}(egret.HashObject);e.InjectionType=t,egret.registerClass(t,"fl.InjectionType")}(fl||(fl={})),fl.InjectionType.VALUE=0,fl.InjectionType.CLASS=1,fl.InjectionType.SINGLETON=2;var fl;!function(e){var t=function(t){function i(){t.call(this),this.m_mappings=new e.Dictionary,this.m_injecteeDescriptions=e.Injector.INJECTION_POINTS_CACHE,this.m_attendedToInjectees=new e.Dictionary(!0)}__extends(i,t);var r=__define,s=i;return p=s.prototype,p.mapValue=function(t,n,i){void 0===i&&(i="");var r=this.getMapping(t,i);return r.setResult(new e.InjectValueResult(n)),r},p.mapClass=function(t,n,i){void 0===i&&(i="");var r=this.getMapping(t,i);return r.setResult(new e.InjectClassResult(n)),r},p.mapSingleton=function(e,t){return void 0===t&&(t=""),this.mapSingletonOf(e,e,t)},p.mapSingletonOf=function(t,n,i){void 0===i&&(i="");var r=this.getMapping(t,i);return r.setResult(new e.InjectSingletonResult(n)),r},p.mapRule=function(t,n,i){void 0===i&&(i="");var r=this.getMapping(t,i);return r.setResult(new e.InjectOtherRuleResult(n)),n},p.getMapping=function(t,n){void 0===n&&(n="");var i=e.getClassName(t),r=this.m_mappings.getItem(i+"#"+n);return r||(r=this.m_mappings.setItem(i+"#"+n,new e.InjectionConfig(t,n))),r},p.injectInto=function(e){this.m_attendedToInjectees.getItem(e)||this.m_attendedToInjectees.setItem(e,!0)},p.instantiate=function(e){var t=this.m_injecteeDescriptions.getItem(e);t||(t=this.getInjectionPoints(e));var n=t.ctor,i=n.applyInjection(e,this);return this.injectInto(i),i},p.unmap=function(t,n){void 0===n&&(n="");var i=this.getConfigurationForRequest(t,n);if(!i)throw new e.InjectorError("Error while removing an injector mapping: No mapping defined for class "+e.getClassName(t)+', named "'+n+'"');i.setResult(null)},p.hasMapping=function(e,t){void 0===t&&(t="");var n=this.getConfigurationForRequest(e,t);return n?n.hasResponse(this):!1},p.getInstance=function(t,n){void 0===n&&(n="");var i=this.getConfigurationForRequest(t,n);if(!i||!i.hasResponse(this))throw new e.InjectorError("Error while getting mapping response: No mapping defined for class "+e.getClassName(t)+', named "'+n+'"');return i.getResponse(this)},p.createChildInjector=function(){var t=new e.Injector;return t.setParentInjector(this),t},p.setParentInjector=function(t){this.m_parentInjector&&!t&&(this.m_attendedToInjectees=new e.Dictionary(!0)),this.m_parentInjector=t,t&&(this.m_attendedToInjectees=t.attendedToInjectees)},p.getParentInjector=function(){return this.m_parentInjector},i.purgeInjectionPointsCache=function(){e.Injector.INJECTION_POINTS_CACHE=new e.Dictionary(!0)},p.getAncestorMapping=function(e,t){void 0===t&&(t=null);for(var n=this.m_parentInjector;n;){var i=n.getConfigurationForRequest(e,t,!1);if(i&&i.hasOwnResponse())return i;n=n.getParentInjector()}return null},r(p,"attendedToInjectees",function(){return this.m_attendedToInjectees},function(e){this.m_attendedToInjectees=e}),p.getInjectionPoints=function(t){var i=[],r=new e.NoParamsConstructorInjectionPoint,s=new n(r,i);return this.m_injecteeDescriptions.setItem(t,s),s},p.getConfigurationForRequest=function(t,n,i){void 0===i&&(i=!0);var r=e.getClassName(t),s=this.m_mappings.getItem(r+"#"+n);return!s&&i&&this.m_parentInjector&&this.m_parentInjector.hasMapping(t,n)&&(s=this.getAncestorMapping(t,n)),s},i}(egret.HashObject);e.Injector=t,egret.registerClass(t,"fl.Injector",["fl.IInjector"]);var n=function(e){function t(t,n){e.call(this),this.ctor=t,this.injectionPoints=n}__extends(t,e);var n=(__define,t);return p=n.prototype,t}(egret.HashObject);egret.registerClass(n,"InjecteeDescription")}(fl||(fl={})),fl.Injector.INJECTION_POINTS_CACHE=new fl.Dictionary(!0);var fl;!function(e){var t=function(e){function t(t,n){void 0===t&&(t=""),void 0===n&&(n=0),e.call(this,t,n)}__extends(t,e);var n=(__define,t);return p=n.prototype,t}(e.Error);e.InjectorError=t,egret.registerClass(t,"fl.InjectorError")}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(){t.call(this)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.classExtendsOrImplements=function(t,n){var i;if(e.isString(t))try{i=egret.getDefinitionByName(t)}catch(r){throw new e.Error("The class name "+t+" is not valid because of "+r+"\n"+r.getStackTrace())}else i=t;if(!i)throw new e.Error("The parameter classOrClassName must be a valid Class instance or fully qualified class name.");return e.is(i,n)},p.getClass=function(t){return e.isClass(t)?t:t.constructor},p.getFQCN=function(t,n){return void 0===n&&(n=!1),e.getClassName(t,n)},n}(egret.HashObject);e.Reflector=t,egret.registerClass(t,"fl.Reflector",["fl.IReflector"])}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(t){e.call(this)}__extends(t,e);var n=(__define,t);return p=n.prototype,p.applyInjection=function(e,t){return e},t}(egret.HashObject);e.InjectionPoint=t,egret.registerClass(t,"fl.InjectionPoint")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(){e.call(this,null)}__extends(t,e);var n=(__define,t);return p=n.prototype,p.applyInjection=function(e,t){return new e},t}(e.InjectionPoint);e.NoParamsConstructorInjectionPoint=t,egret.registerClass(t,"fl.NoParamsConstructorInjectionPoint")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);return p=n.prototype,p.getResponse=function(e){return null},t}(egret.HashObject);e.InjectionResult=t,egret.registerClass(t,"fl.InjectionResult")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(t){e.call(this),this.m_responseType=t}__extends(t,e);var n=(__define,t);return p=n.prototype,p.getResponse=function(e){return e.instantiate(this.m_responseType)},t}(e.InjectionResult);e.InjectClassResult=t,egret.registerClass(t,"fl.InjectClassResult")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(t){e.call(this),this.m_rule=t}__extends(t,e);var n=(__define,t);return p=n.prototype,p.getResponse=function(e){return this.m_rule.getResponse(e)},t}(e.InjectionResult);e.InjectOtherRuleResult=t,egret.registerClass(t,"fl.InjectOtherRuleResult")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(t){e.call(this),this.m_responseType=t}__extends(t,e);var n=(__define,t);return p=n.prototype,p.getResponse=function(e){return this.m_response=this.m_response||this.createResponse(e)},p.createResponse=function(e){return e.instantiate(this.m_responseType)},t}(e.InjectionResult);e.InjectSingletonResult=t,egret.registerClass(t,"fl.InjectSingletonResult")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(t){e.call(this),this.m_value=t}__extends(t,e);var n=(__define,t);return p=n.prototype,p.getResponse=function(e){return this.m_value},t}(e.InjectionResult);e.InjectValueResult=t,egret.registerClass(t,"fl.InjectValueResult")}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(n){t.call(this),this.context=n,this.eventDispatcher=n.eventDispatcher,this.injector=n.createChildInjector(),this.reflector=n.reflector,this.eventTypeMap=new e.Dictionary(!1),this.verifiedCommandClasses=new e.Dictionary(!1),this.detainedCommands=new e.Dictionary(!1)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.mapEvent=function(t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=!1);var s=this;this.verifyCommandClass(n),i=i||egret.Event;var o=this.eventTypeMap.getItem(t,new e.Dictionary(!1)),a=o.getItem(i,new e.Dictionary(!1));if(a.getItem(n))throw new e.ContextError(e.ContextError.E_COMMANDMAP_OVR+" - eventType ("+t+") and Command ("+n+")");var c=function(e){s.routeEventToCommand(e,n,r,i)};this.eventDispatcher.addEventListener(t,c,null,!1,0),a.setItem(n,c)},p.unmapEvent=function(e,t,n){void 0===n&&(n=null);var i=this.eventTypeMap.getItem(e);if(null!=i){var r=i.getItem(n||egret.Event);if(null!=r){var s=r.getItem(t);null!=s&&(this.eventDispatcher.removeEventListener(e,s,null,!1),r.delItem(t))}}},p.unmapEvents=function(){for(var t in this.eventTypeMap.map){var n=this.eventTypeMap.map[t],i=n[0],r=n[1];for(var s in r.map){var o=r.map[s][1];for(var a in o.map){var c=o.map[a][1];this.eventDispatcher.removeEventListener(i,c,null,!1)}}}this.eventTypeMap=new e.Dictionary(!1)},p.hasEventCommand=function(e,t,n){void 0===n&&(n=null);var i=this.eventTypeMap.getItem(e);if(null==i)return!1;var r=i.getItem(n||egret.Event);return null==r?!1:null!=r.getItem(t)},p.execute=function(t,n,i,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=""),this.verifyCommandClass(t),(null!=n||null!=i)&&(i=i||this.reflector.getClass(n),e.is(n,egret.Event)&&i!=egret.Event&&this.injector.mapValue(egret.Event,n),this.injector.mapValue(i,n,r));var s=this.injector.instantiate(t);(null!==n||null!=i)&&(e.is(n,egret.Event)&&i!=egret.Event&&this.injector.unmap(egret.Event),this.injector.unmap(i,r)),s.execute()},p.detain=function(e){this.detainedCommands.setItem(e,!0)},p.release=function(e){this.detainedCommands.delItem(e)},p.verifyCommandClass=function(e){},p.routeEventToCommand=function(t,n,i,r){return e.is(t,r)?(this.execute(n,t),i&&this.unmapEvent(t.type,n,r),!0):!1},n}(egret.HashObject);e.CommandMap=t,egret.registerClass(t,"fl.CommandMap",["fl.ICommandMap"])}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(){t.call(this),this._eventDispatcher=this.createEventDispatcher()}__extends(n,t);var i=__define,r=n;return p=r.prototype,i(p,"contextView",function(){return this._contextView},function(e){this._contextView=e}),i(p,"injector",function(){return this._injector=this._injector||this.createInjector()},function(e){this._injector=e}),p.createInjector=function(){return null},p.createChildInjector=function(){return this.injector.createChildInjector()},i(p,"reflector",function(){return this._reflector=this._reflector||this.createReflector()},function(e){this._reflector=e}),p.createReflector=function(){return null},i(p,"commandMap",function(){return this._commandMap=this._commandMap||new e.CommandMap(this)},function(e){this._commandMap=e}),i(p,"mediatorMap",function(){return this._mediatorMap=this._mediatorMap||new e.MediatorMap(this)},function(e){this._mediatorMap=e}),i(p,"viewMap",function(){return this._viewMap=this._viewMap||new e.ViewMap(this)},function(e){this._viewMap=e}),p.createEventDispatcher=function(){return new egret.EventDispatcher(this)},i(p,"eventDispatcher",function(){return this._eventDispatcher},function(e){this._eventDispatcher=e}),p.once=function(e,t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=0),this.eventDispatcher.once(e,t,n,i,r)},p.addEventListener=function(e,t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=0),this.eventDispatcher.addEventListener(e,t,n,i,r)},p.dispatchEvent=function(e){return this.eventDispatcher.hasEventListener(e.type)?this.eventDispatcher.dispatchEvent(e):!1},p.hasEventListener=function(e){return this.eventDispatcher.hasEventListener(e)},p.removeEventListener=function(e,t,n,i){void 0===i&&(i=!1),this.eventDispatcher.removeEventListener(e,t,n,i)},p.willTrigger=function(e){return this.eventDispatcher.willTrigger(e)},n}(egret.HashObject);e.ContextBase=t,egret.registerClass(t,"fl.ContextBase",["fl.IContext","egret.IEventDispatcher"])}(fl||(fl={}));var fl;!function(e){var t=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=0),this.message=e,this.name=String(t)}var t=(__define,e);return p=t.prototype,e}();e.ContextError=t,egret.registerClass(t,"fl.ContextError")}(fl||(fl={})),fl.ContextError.E_COMMANDMAP_NOIMPL="Command Class does not implement an execute() method",fl.ContextError.E_COMMANDMAP_OVR="Cannot overwrite map",fl.ContextError.E_MEDIATORMAP_NOIMPL="Mediator Class does not implement IMediator",fl.ContextError.E_MEDIATORMAP_OVR="Mediator Class has already been mapped to a View Class in this context",fl.ContextError.E_EVENTMAP_NOSNOOPING="Listening to the context eventDispatcher is not enabled for this EventMap",fl.ContextError.E_CONTEXT_INJECTOR="The ContextBase does not specify a concrete IInjector. Please override the injector getter in your concrete or abstract Context.",fl.ContextError.E_CONTEXT_REFLECTOR="The ContextBase does not specify a concrete IReflector. Please override the reflector getter in your concrete or abstract Context.",fl.ContextError.E_CONTEXT_VIEW_OVR="Context contextView must only be set once";var fl;!function(e){var t=function(t){function n(e,n){void 0===n&&(n=null),t.call(this,e),this._body=n}__extends(n,t);var i=__define,r=n;return p=r.prototype,i(p,"body",function(){return this._body},function(e){this.body=e}),p.clone=function(){return new e.ContextEvent(this.type,this.body)},n}(egret.Event);e.ContextEvent=t,egret.registerClass(t,"fl.ContextEvent")}(fl||(fl={})),fl.ContextEvent.STARTUP="startup",fl.ContextEvent.STARTUP_COMPLETE="startupComplete",fl.ContextEvent.SHUTDOWN="shutdown",fl.ContextEvent.SHUTDOWN_COMPLETE="shutdownComplete";var fl;!function(e){var t=function(t){function n(e){t.call(this),this._dispatcherListeningEnabled=!0,this.listeners=new Array,this.eventDispatcher=e}__extends(n,t);var i=__define,r=n;return p=r.prototype,i(p,"dispatcherListeningEnabled",function(){return this._dispatcherListeningEnabled},function(e){this._dispatcherListeningEnabled=e}),p.mapListener=function(t,n,i,r,s,o,a){void 0===s&&(s=null),void 0===o&&(o=!1),void 0===a&&(a=0);var c=this;if(0==this.dispatcherListeningEnabled&&t==this.eventDispatcher)throw new e.ContextError(e.ContextError.E_EVENTMAP_NOSNOOPING).message;s=s||egret.Event;for(var p,u=this.listeners.length;u--;)if(p=this.listeners[u],p.dispatcher==t&&p.type==n&&p.listener==i&&p.thisObject==r&&p.useCapture==o&&p.eventClass==s)return;var l=function(e){c.routeEventToListener(e,i,r,s)};p={dispatcher:t,type:n,listener:i,thisObject:r,eventClass:s,callback:l,useCapture:o},this.listeners.push(p),t.addEventListener(n,l,r,o,a)},p.unmapListener=function(e,t,n,i,r,s){void 0===r&&(r=null),void 0===s&&(s=!1),r=r||egret.Event;for(var o,a=this.listeners.length;a--;)if(o=this.listeners[a],o.dispatcher==e&&o.type==t&&o.listener==n&&o.thisObject==i&&o.useCapture==s&&o.eventClass==r)return e.removeEventListener(t,o.callback,o.thisObject,s),void this.listeners.splice(a,1)},p.unmapListeners=function(){for(var e,t;e=this.listeners.pop();)t=e.dispatcher,t.removeEventListener(e.type,e.callback,e.thisObject,e.useCapture)},p.routeEventToListener=function(t,n,i,r){e.is(t,r)&&n.call(i,t)},n}(egret.HashObject);e.EventMap=t,egret.registerClass(t,"fl.EventMap",["fl.IEventMap"])}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(){t.call(this),this.removed=!1}__extends(n,t);var i=__define,r=n;return p=r.prototype,i(p,"context",function(){return this._context},function(e){this._context=e,this.updateContext()}),p.updateContext=function(){},p.preRegister=function(){this.removed=!1,e.is(this.viewComponent,e.MediatorBase.UIComponentClass)&&!e.isComponentInited(this.viewComponent)?this.viewComponent.addEventListener("creationComplete",this.onCreationComplete,this,!1,0):this.onRegister()},p.onRegister=function(){},p.preRemove=function(){this.removed=!0,this.onRemove()},p.onRemove=function(){},p.getViewComponent=function(){return this.viewComponent},p.setViewComponent=function(e){this.viewComponent=e},p.onCreationComplete=function(e){e.target.removeEventListener("creationComplete",this.onCreationComplete,this,!1),this.removed||this.onRegister()},n.UIComponentClass="eui.UIComponent",n}(egret.HashObject);e.MediatorBase=t,egret.registerClass(t,"fl.MediatorBase",["fl.IMediator"])}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(t){e.call(this),this._enabled=!0,this.useCapture=!1,this.viewListenerCount=0,this.context=t,this.injector=t.injector,this.useCapture=!0,this.contextView=t.contextView}__extends(t,e);var n=__define,i=t;return p=i.prototype,n(p,"contextView",function(){return this._contextView},function(e){e!=this._contextView&&(this.removeListeners(),this._contextView=e,this.viewListenerCount>0&&this.addListeners())}),n(p,"enabled",function(){return this._enabled},function(e){e!=this._enabled&&(this.removeListeners(),this._enabled=e,this.viewListenerCount>0&&this.addListeners())}),p.addListeners=function(){},p.removeListeners=function(){},p.onViewAdded=function(e){},t}(egret.HashObject);e.ViewMapBase=t,egret.registerClass(t,"fl.ViewMapBase")}(fl||(fl={}));var fl;!function(e){var t=function(t){function i(n){t.call(this,n),this.hasMediatorsMarkedForRemoval=!1,this.reflector=n.reflector,this.mediatorByView=new e.Dictionary(!0),this.mappingConfigByView=new e.Dictionary(!0),this.mappingConfigByViewClassName=new e.Dictionary(!1),this.mediatorsMarkedForRemoval=new e.Dictionary(!1)}__extends(i,t);var r=(__define,i);return p=r.prototype,p.mapView=function(t,i,r,s,o){void 0===r&&(r=null),void 0===s&&(s=!0),void 0===o&&(o=!0);var a=this.reflector.getFQCN(t);if(null!=this.mappingConfigByViewClassName.getItem(a))throw new e.ContextError(e.ContextError.E_MEDIATORMAP_OVR+" - "+i);if(0==this.reflector.classExtendsOrImplements(i,e.IMediator))throw new e.ContextError(e.ContextError.E_MEDIATORMAP_NOIMPL+" - "+i);var c=new n;c.mediatorClass=i,c.autoCreate=s,c.autoRemove=o,r?e.isArray(r)?c.typedViewClasses=r.concat():e.isString(r)||(c.typedViewClasses=[r]):t&&!e.isString(t)&&(c.typedViewClasses=[t]),e.injectContextView(a,this.contextView),this.mappingConfigByViewClassName.setItem(a,c),(s||o)&&(this.viewListenerCount++,1==this.viewListenerCount&&this.addListeners()),s&&this.contextView&&a==e.getClassName(this.contextView)&&this.createMediatorUsing(this.contextView,a,c)},p.unmapView=function(t){var n=this.reflector.getFQCN(t);e.uninjectContextView(n);var i=this.mappingConfigByViewClassName.getItem(n);i&&(i.autoCreate||i.autoRemove)&&(this.viewListenerCount--,0==this.viewListenerCount&&this.removeListeners()),this.mappingConfigByViewClassName.delItem(n)},p.createMediator=function(e){return this.createMediatorUsing(e)},p.registerMediator=function(t,n){var i=this.reflector.getClass(n);this.injector.hasMapping(i)&&this.injector.unmap(i),this.injector.mapValue(i,n),this.mediatorByView.setItem(t,n),this.mappingConfigByView.setItem(t,this.mappingConfigByViewClassName.getItem(e.getClassName(t))),n.setViewComponent(t),n.preRegister()},p.removeMediator=function(e){if(e){var t=e.getViewComponent(),n=this.reflector.getClass(e);this.mediatorByView.delItem(t),this.mappingConfigByView.delItem(t),e.preRemove(),e.setViewComponent(null),this.injector.hasMapping(n)&&this.injector.unmap(n)}return e},p.removeMediatorByView=function(e){return this.removeMediator(this.retrieveMediator(e))},p.retrieveMediator=function(e){return this.mediatorByView.getItem(e)},p.hasMapping=function(e){var t=this.reflector.getFQCN(e);return null!=this.mappingConfigByViewClassName.getItem(t)},p.hasMediatorForView=function(e){return null!=this.mediatorByView.getItem(e)},p.hasMediator=function(e){for(var t in this.mediatorByView.map){var n=this.mediatorByView.map[t][1];if(n==e)return!0}return!1},p.addListeners=function(){this.contextView&&this.enabled&&(this.contextView.addEventListener(egret.Event.ADDED_TO_STAGE,this.onViewAdded,this,this.useCapture,0),this.contextView.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onViewRemoved,this,this.useCapture,0))},p.removeListeners=function(){this.contextView&&(this.contextView.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onViewAdded,this,this.useCapture),this.contextView.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onViewRemoved,this,this.useCapture))},p.onViewAdded=function(t){if(this.mediatorsMarkedForRemoval.getItem(t.target))return void this.mediatorsMarkedForRemoval.delItem(t.target);var n=e.getClassName(t.target),i=this.mappingConfigByViewClassName.getItem(n);i&&i.autoCreate&&this.createMediatorUsing(t.target,n,i)},p.createMediatorUsing=function(t,n,i){void 0===n&&(n=""),void 0===i&&(i=null);var r=this.mediatorByView.getItem(t);if(null==r&&(n=n||e.getClassName(t),i=i||this.mappingConfigByViewClassName.getItem(n))){for(var s in i.typedViewClasses){var o=i.typedViewClasses[s];this.injector.mapValue(o,t)}r=this.injector.instantiate(i.mediatorClass),r.context=this.context;for(var a in i.typedViewClasses){var c=i.typedViewClasses[a];this.injector.unmap(c)}this.registerMediator(t,r)}return r},p.onViewRemoved=function(e){var t=this.mappingConfigByView.getItem(e.target);t&&t.autoRemove&&(this.mediatorsMarkedForRemoval.setItem(e.target,e.target),this.hasMediatorsMarkedForRemoval||(this.hasMediatorsMarkedForRemoval=!0,egret.startTick(this.removeMediatorLater,this)))},p.removeMediatorLater=function(e){this.hasMediatorsMarkedForRemoval=!1,egret.stopTick(this.removeMediatorLater,this);for(var t in this.mediatorsMarkedForRemoval.map){var n=this.mediatorsMarkedForRemoval.map[t][1];n.stage||this.removeMediatorByView(n),this.mediatorsMarkedForRemoval.delItem(n)}return this.hasMediatorsMarkedForRemoval=!1,!0},i}(e.ViewMapBase);e.MediatorMap=t,egret.registerClass(t,"fl.MediatorMap",["fl.IMediatorMap"]);var n=function(e){function t(){e.apply(this,arguments),this.autoCreate=!1,this.autoRemove=!1}__extends(t,e);var n=(__define,t);return p=n.prototype,t}(egret.HashObject);e.MappingConfig=n,egret.registerClass(n,"fl.MappingConfig")}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(n){t.call(this,n),this.mappedPackages=new Array,this.mappedTypes=new e.Dictionary(!1),this.injectedViews=new e.Dictionary(!0)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.mapPackage=function(e){-1==this.mappedPackages.indexOf(e)&&(this.mappedPackages.push(e),this.viewListenerCount++,1==this.viewListenerCount&&this.addListeners())},p.unmapPackage=function(e){var t=this.mappedPackages.indexOf(e);t>-1&&(this.mappedPackages.splice(t,1),this.viewListenerCount--,0==this.viewListenerCount&&this.removeListeners())},p.mapType=function(t){this.mappedTypes.getItem(t)||(this.mappedTypes.setItem(t,t),this.viewListenerCount++,1==this.viewListenerCount&&this.addListeners(),this.contextView&&e.is(this.contextView,t)&&this.injectInto(this.contextView))},p.unmapType=function(e){var t=this.mappedTypes.getItem(e);this.mappedTypes.delItem(e),t&&(this.viewListenerCount--,0==this.viewListenerCount&&this.removeListeners())},p.hasType=function(e){return null!=this.mappedTypes.getItem(e)},p.hasPackage=function(e){return this.mappedPackages.indexOf(e)>-1},p.addListeners=function(){this.contextView&&this.enabled&&this.contextView.addEventListener(egret.Event.ADDED_TO_STAGE,this.onViewAdded,this,this.useCapture,0)},p.removeListeners=function(){this.contextView&&this.contextView.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onViewAdded,this,this.useCapture)},p.onViewAdded=function(t){var n=t.target;if(!this.injectedViews.getItem(n)){for(var i in this.mappedTypes.map){var r=this.mappedTypes.map[i][1];if(e.is(n,r))return void this.injectInto(n)}var s=this.mappedPackages.length;if(s>0)for(var o=e.getClassName(n),a=0;s>a;a++){var c=this.mappedPackages[a];if(0==o.indexOf(c))return void this.injectInto(n)}}},p.injectInto=function(e){this.injector.injectInto(e),this.injectedViews.setItem(e,!0)},n}(e.ViewMapBase);e.ViewMap=t,egret.registerClass(t,"fl.ViewMap",["fl.IViewMap"])}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(){t.call(this)}__extends(n,t);var i=__define,r=n;return p=r.prototype,i(p,"eventDispatcher",function(){return this._eventDispatcher},function(e){this._eventDispatcher=e}),i(p,"eventMap",function(){return this._eventMap||(this._eventMap=new e.EventMap(this.eventDispatcher))},function(e){this._eventMap=e}),p.dispatch=function(e){return this.eventDispatcher.hasEventListener(e.type)?this.eventDispatcher.dispatchEvent(e):!1},n}(egret.HashObject);e.Actor=t,egret.registerClass(t,"fl.Actor")}(fl||(fl={}));var fl;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);return p=n.prototype,p.execute=function(){},p.dispatch=function(e){return this.eventDispatcher.hasEventListener(e.type)?this.eventDispatcher.dispatchEvent(e):!1},t}(egret.HashObject);e.Command=t,egret.registerClass(t,"fl.Command")}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(e,n){void 0===e&&(e=null),void 0===n&&(n=!0),t.call(this),this._autoStartup=!1,this._autoStartup=n,this.contextView=e}__extends(n,t);var i=__define,r=n;return p=r.prototype,p.startup=function(){this.dispatchEvent(new e.ContextEvent(e.ContextEvent.STARTUP_COMPLETE))},p.shutdown=function(){this.dispatchEvent(new e.ContextEvent(e.ContextEvent.SHUTDOWN_COMPLETE))},i(p,"contextView",function(){return this._contextView},function(t){if(t!=this._contextView){if(this._contextView)throw new e.ContextError(e.ContextError.E_CONTEXT_VIEW_OVR);this._contextView=t,this.mapInjections(),this.checkAutoStartup()}}),p.mapInjections=function(){this.injector.mapValue(e.IReflector,this.reflector),this.injector.mapValue(e.IInjector,this.injector),this.injector.mapValue("egret.IEventDispatcher",this.eventDispatcher),this.injector.mapValue(egret.DisplayObjectContainer,this.contextView),this.injector.mapValue(e.ICommandMap,this.commandMap),this.injector.mapValue(e.IMediatorMap,this.mediatorMap),this.injector.mapValue(e.IViewMap,this.viewMap),this.injector.mapClass(e.IEventMap,e.EventMap)
},p.checkAutoStartup=function(){this._autoStartup&&this.contextView&&(this.contextView.stage?this.startup():this.contextView.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this,!1,0))},p.onAddedToStage=function(e){this.contextView.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),this.startup()},p.createInjector=function(){var t=new e.Injector;return t},p.createReflector=function(){var t=new e.Reflector;return t},n}(e.ContextBase);e.Context=t,egret.registerClass(t,"fl.Context",["fl.IContext"])}(fl||(fl={}));var fl;!function(e){var t=function(t){function n(){t.call(this)}__extends(n,t);var i=__define,r=n;return p=r.prototype,p.updateContext=function(){t.prototype.updateContext.call(this),this._eventDispatcher=this.context.eventDispatcher},p.preRemove=function(){this._eventMap&&this._eventMap.unmapListeners(),t.prototype.preRemove.call(this)},i(p,"eventDispatcher",function(){return this._eventDispatcher},function(e){this._eventDispatcher=e}),i(p,"eventMap",function(){return this._eventMap||(this._eventMap=new e.EventMap(this.eventDispatcher))},function(e){this._eventMap=e}),p.dispatch=function(e){return this.eventDispatcher.hasEventListener(e.type)?this.eventDispatcher.dispatchEvent(e):!1},p.addViewListener=function(e,t,n,i,r,s){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===s&&(s=0),this.eventMap.mapListener(this.viewComponent,e,t,n,i,r,s)},p.removeViewListener=function(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=!1),this.eventMap.unmapListener(this.viewComponent,e,t,n,i,r)},p.addContextListener=function(e,t,n,i,r,s){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===s&&(s=0),this.eventMap.mapListener(this.eventDispatcher,e,t,n,i,r,s)},p.removeContextListener=function(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=!1),this.eventMap.unmapListener(this.eventDispatcher,e,t,n,i,r)},n}(e.MediatorBase);e.Mediator=t,egret.registerClass(t,"fl.Mediator")}(fl||(fl={}));